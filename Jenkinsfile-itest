node('docker') {
    stage('Clone') {
        cleanWs()
        checkoutInfo = checkout(scm)
        echo "git checkout: ${checkoutInfo}"
    }
    /*
    stage('Up') {
        withCredentials([
            usernamePassword(credentialsId: 'docker-regis',
            usernameVariable: 'username', passwordVariable: 'password')
        ]) {
            def registry = 'docker-regis.iex.ec'
            sh "echo -n '${password}' | docker login --username '${username}' --password-stdin ${registry}"
            sh './docker/test/up.sh'
            sh "docker logout ${registry}"
        }
    }
    */
    docker.image('node:22-alpine').inside {
        stage('Init') {
            sh 'npm ci'
        }
        stage('Integration tests') {
            sh 'DEBUG=testcontainers:compose npm run itest'
        }
    }
    /*
    stage('Down') {
        sh './docker/test/down.sh'
    }
    */
}
