node('docker') {
    stage('Clean Workspace') {
        cleanWs()
    }
    stage('Checkout scm') {
        checkout scm
    }
    stage('Up') {
        sh './docker/test/up.sh'
    }
    docker.image('node:22-alpine').inside {
        stage('Init') {
            sh 'npm ci'
        }
        stage('Test') {
            sh 'npm run itest'
        }
    }
    stage('Down') {
        sh './docker/test/down.sh'
    }
}
